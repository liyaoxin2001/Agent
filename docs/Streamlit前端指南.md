# Streamlit 前端使用指南

本指南介绍如何使用 HuahuaChat 的 Streamlit Web 界面。

---

## 🚀 快速开始

### 1. 确保 API 服务运行

首先启动后端 API 服务（在一个终端中）：

```bash
python run_api.py --reload
```

访问 http://localhost:8000/docs 确认 API 正常运行。

### 2. 启动 Streamlit 应用

在新的终端中启动 Streamlit：

**方式一：使用启动脚本**

```bash
python run_streamlit.py
```

**方式二：直接运行**

```bash
streamlit run streamlit_app.py
```

### 3. 访问 Web 界面

浏览器会自动打开，或手动访问：

```
http://localhost:8501
```

---

## 📖 功能介绍

### 1️⃣ 智能对话 💬

**功能**：与知识库进行智能问答对话

**使用步骤**：

1. 在侧边栏选择一个知识库
2. 在对话框中输入问题
3. 点击"🚀 发送"
4. 查看 AI 生成的答案

**特点**：
- ✅ 支持多轮对话（自动保持上下文）
- ✅ 显示检索到的相关文档
- ✅ 实时响应

**示例对话**：
```
用户: Python 是什么？
助手: Python 是一种高级编程语言，以其简洁易读的语法而闻名...

用户: 它的主要应用领域有哪些？
助手: Python 广泛应用于 Web 开发、数据科学、人工智能...
```

**操作**：
- **发送消息**: 输入问题后点击"🚀 发送"
- **清空对话**: 点击"🗑️ 清空对话"重新开始

---

### 2️⃣ 知识库管理 📚

**功能**：创建、查看、删除知识库

#### 创建知识库

1. 点击"➕ 创建新知识库"展开
2. 输入知识库名称（如 `tech_kb`）
3. 输入描述（可选）
4. 点击"创建"

**命名规则**：
- 使用英文、数字、下划线
- 避免特殊字符
- 建议使用有意义的名称

#### 查看知识库

在知识库列表中，每个知识库显示：
- 📚 名称
- 📝 描述
- 📊 文档数量
- 🔧 Embedding 模型

点击"📊 查看"可切换到该知识库。

#### 删除知识库

1. 点击知识库旁的"🗑️ 删除"
2. 再次点击确认删除

⚠️ **注意**: 删除知识库会同时删除其中的所有文档，不可恢复！

---

### 3️⃣ 文档上传 📄

**功能**：上传文档到知识库

#### 上传文件

1. 在侧边栏选择目标知识库
2. 点击"Browse files"选择文件
3. 查看文件信息（名称、大小、类型）
4. 点击"📤 上传到知识库"

**支持的文件类型**：
- ✅ `.txt` - 纯文本文件
- ✅ `.pdf` - PDF 文档
- ✅ `.md` / `.markdown` - Markdown 文档

**上传限制**：
- 单个文件大小: 建议 < 10MB
- 文件格式: 必须是支持的类型

#### 查看已上传文档

在"已上传的文档"区域可以看到：
- 📄 文件名
- 🔢 分块数量
- 📅 上传时间

---

## 🎨 界面说明

### 侧边栏

**API 状态**：
- ✅ 绿色 - API 服务正常
- ❌ 红色 - API 服务未运行

**导航**：
- 💬 智能对话
- 📚 知识库管理
- 📄 文档上传

**知识库选择**：
- 下拉菜单选择当前使用的知识库
- 显示知识库详细信息

**关于**：
- 系统版本信息
- 技术栈
- 作者信息

### 主界面

根据选择的导航显示不同内容：
- 聊天界面：对话历史 + 输入框
- 知识库管理：知识库列表 + 创建表单
- 文档上传：上传区域 + 文档列表

---

## 💡 使用技巧

### 1. 多轮对话

系统会自动记住对话历史，可以进行连续提问：

```
Q1: Python 是什么？
A1: [关于 Python 的介绍]

Q2: 它有什么优点？  ← 系统知道"它"指的是 Python
A2: [Python 的优点]
```

### 2. 切换知识库

在侧边栏切换知识库后，对话会自动重置，确保问答基于正确的知识源。

### 3. 文件管理建议

- **命名规范**: 使用有意义的文件名
- **分类管理**: 为不同主题创建不同知识库
- **定期清理**: 删除过时文档

### 4. 提问技巧

- ✅ 清晰具体: "Python 的列表推导式如何使用？"
- ❌ 模糊笼统: "Python 怎么样？"
  
- ✅ 结合上下文: "这个库的安装方法是什么？"
- ✅ 分步提问: 复杂问题拆分成多个小问题

---

## 🐛 常见问题

### 1. API 服务未运行

**症状**: 侧边栏显示"❌ API 服务未运行"

**解决**:
```bash
# 在新终端启动 API 服务
python run_api.py --reload
```

### 2. 无法选择知识库

**症状**: 知识库下拉菜单为空

**解决**:
1. 先创建一个知识库
2. 刷新页面

### 3. 文件上传失败

**症状**: 上传后显示错误

**可能原因**:
- 文件格式不支持
- 文件损坏
- API 服务异常

**解决**:
1. 检查文件格式（txt/pdf/md）
2. 尝试其他文件
3. 查看 API 日志

### 4. 聊天没有响应

**症状**: 发送消息后没有回复

**可能原因**:
- 知识库为空
- OpenAI API Key 未配置
- 网络问题

**解决**:
1. 确认知识库有文档
2. 检查 `.env` 文件中的 API Key
3. 查看 API 服务日志

---

## 🔧 高级配置

### 修改端口

**Streamlit 端口** (默认 8501):

```bash
streamlit run streamlit_app.py --server.port=8502
```

**API 端口** (默认 8000):

修改 `streamlit_app.py` 中的 `API_BASE_URL`：

```python
API_BASE_URL = "http://localhost:8080"  # 修改为你的 API 端口
```

### 自定义样式

在 `streamlit_app.py` 中修改 CSS 样式：

```python
st.markdown("""
<style>
    .main-header {
        color: #your-color;  # 修改主标题颜色
    }
</style>
""", unsafe_allow_html=True)
```

---

## 📊 使用示例

### 完整工作流

#### 1. 创建知识库

```
导航: 📚 知识库管理
操作: 创建知识库
名称: python_docs
描述: Python 官方文档
```

#### 2. 上传文档

```
导航: 📄 文档上传
知识库: python_docs
文件: python_tutorial.pdf
操作: 上传
```

#### 3. 开始对话

```
导航: 💬 智能对话
知识库: python_docs
问题: Python 中如何定义函数？
```

---

## 🎯 下一步

- 尝试不同类型的问题
- 上传更多文档丰富知识库
- 体验多轮对话功能
- 探索不同主题的知识库

---

## 📝 反馈

如有问题或建议，请：
- 查看日志文件
- 检查 API 文档: http://localhost:8000/docs
- 阅读开发文档

---

**Happy Chatting! 🚀**
