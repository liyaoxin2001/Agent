# é˜¶æ®µä¸‰ - AgentState å’Œ Nodes å®Œæˆæ€»ç»“

## ğŸ“Š å®Œæˆæ—¶é—´

**å®Œæˆæ—¥æœŸ**: 2026-01-13

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### ä¸€ã€AgentState æ¨¡å— âœ…

#### 1.1 æ ¸å¿ƒå®ç°

**æ–‡ä»¶**: `src/agent/state.py` (420+ è¡Œ)

**å®Œæˆå†…å®¹**ï¼š

âœ… **ä¸‰ä¸ªç‰ˆæœ¬çš„ AgentState**

| ç‰ˆæœ¬ | ç±»å | å­—æ®µæ•° | é€‚ç”¨åœºæ™¯ |
|------|------|--------|----------|
| åŸºç¡€ç‰ˆ | `AgentStateBasic` | 3 | å­¦ä¹ å…¥é—¨ï¼Œç®€å• RAG |
| å¯¹è¯ç‰ˆ | `AgentStateConversational` | 7 | å¤šè½®å¯¹è¯ï¼ŒæŸ¥è¯¢æ”¹å†™ |
| å®Œæ•´ç‰ˆ | `AgentState` | 18 | ç”Ÿäº§ç¯å¢ƒï¼Œæ‰€æœ‰åŠŸèƒ½ |

âœ… **è¾…åŠ©å‡½æ•°** (3ä¸ª)
- `create_initial_state()` - åˆ›å»ºå®Œæ•´ç‰ˆæœ¬çŠ¶æ€
- `create_basic_state()` - åˆ›å»ºåŸºç¡€ç‰ˆæœ¬çŠ¶æ€
- `create_conversational_state()` - åˆ›å»ºå¯¹è¯ç‰ˆæœ¬çŠ¶æ€

âœ… **ç±»å‹å®‰å…¨è®¾è®¡**
- ä½¿ç”¨ TypedDict æä¾›ç±»å‹æ£€æŸ¥
- æ‰€æœ‰å­—æ®µéƒ½æœ‰å®Œæ•´çš„ç±»å‹æ³¨è§£
- Optional æ˜ç¡®è¡¨ç¤ºå¯é€‰å­—æ®µ

#### 1.2 æ–‡æ¡£æ€»ç»“

**å·²å®Œæˆæ–‡æ¡£**ï¼š

1. **`docs/AgentStateæ¨¡å—çŸ¥è¯†ç‚¹æ€»ç»“.md`** (70,000+ å­—)
   - æ ¸å¿ƒæ¦‚å¿µè¯¦è§£
   - ä¸ºä»€ä¹ˆéœ€è¦ State
   - ä¸‰ä¸ªç‰ˆæœ¬çš„å®Œæ•´è¯´æ˜
   - æ‰€æœ‰å­—æ®µçš„è¯¦ç»†è§£é‡Š
   - æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜

2. **`docs/é˜¶æ®µä¸‰_Stateå®ç°æŒ‡å¼•.md`** (30,000+ å­—)
   - æ¦‚å¿µå’Œè®¾è®¡åŸåˆ™
   - å­—æ®µè®¾è®¡æŒ‡å—
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

3. **`docs/é˜¶æ®µä¸‰_å¿«é€Ÿå¼€å§‹.md`** (12,000+ å­—)
   - å­¦ä¹ è·¯å¾„
   - å¿«é€Ÿå‚è€ƒ
   - è°ƒè¯•æŠ€å·§

4. **`docs/å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å­—æ®µ_å®è·µæŒ‡å—.md`** (18,000+ å­—)
   - è¯¦ç»†æ­¥éª¤æŒ‡å¯¼
   - ä»£ç ç¤ºä¾‹
   - å®è·µç»ƒä¹ 

#### 1.3 æµ‹è¯•å’Œç»ƒä¹ 

**æµ‹è¯•æ–‡ä»¶**ï¼š

1. **`examples/test_agent_state.py`** (440+ è¡Œ)
   - 5 ä¸ªå®Œæ•´æµ‹è¯•ç”¨ä¾‹
   - æµ‹è¯•ä¸‰ä¸ªç‰ˆæœ¬çš„ State
   - é”™è¯¯å¤„ç†å’Œæ­¥éª¤é™åˆ¶æµ‹è¯•

2. **`examples/practice_custom_state.py`** (500+ è¡Œ)
   - 4 ä¸ªäº’åŠ¨ç»ƒä¹ 
   - ä»ç®€å•åˆ°å¤æ‚
   - æ•™å­¦å¯¼å‘è®¾è®¡

---

### äºŒã€Agent èŠ‚ç‚¹æ¨¡å— âœ…

#### 2.1 æ ¸å¿ƒå®ç°

**æ–‡ä»¶**: `src/agent/nodes.py` (450+ è¡Œ)

**å®Œæˆå†…å®¹**ï¼š

âœ… **æ ¸å¿ƒèŠ‚ç‚¹** (3ä¸ª)

| èŠ‚ç‚¹ | å‡½æ•°å | ä½œç”¨ | å®ç°æ–¹å¼ |
|------|--------|------|----------|
| æ£€ç´¢èŠ‚ç‚¹ | `create_retrieve_node()` | ä»å‘é‡åº“æ£€ç´¢æ–‡æ¡£ | å·¥å‚å‡½æ•° |
| ç”ŸæˆèŠ‚ç‚¹ | `create_generate_node()` | åŸºäºæ–‡æ¡£ç”Ÿæˆç­”æ¡ˆ | å·¥å‚å‡½æ•° |
| å†³ç­–èŠ‚ç‚¹ | `decide_node()` | å†³å®šä¸‹ä¸€æ­¥æ“ä½œ | çº¯å‡½æ•° |

âœ… **è¾…åŠ©èŠ‚ç‚¹** (3ä¸ª)
- `rewrite_query_node()` - æŸ¥è¯¢æ”¹å†™ï¼ˆä»£è¯æ¶ˆè§£ï¼‰
- `evaluate_node()` - ç­”æ¡ˆè´¨é‡è¯„ä¼°
- `should_continue()` - ç»§ç»­åˆ¤æ–­

âœ… **é«˜çº§èŠ‚ç‚¹** (1ä¸ª)
- `create_stream_generate_node()` - æµå¼ç”ŸæˆèŠ‚ç‚¹

**è®¾è®¡ç‰¹ç‚¹**ï¼š

1. **å·¥å‚æ¨¡å¼**ï¼šæ³¨å…¥å¤–éƒ¨ä¾èµ–ï¼ˆLLM, VectorStoreï¼‰
2. **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹
3. **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šä¸ä¼šå› å¼‚å¸¸ä¸­æ–­æµç¨‹
4. **è¯¦ç»†çš„æ³¨é‡Š**ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²

#### 2.2 èŠ‚ç‚¹åŠŸèƒ½è¯¦è§£

**1. æ£€ç´¢èŠ‚ç‚¹ (retrieve_node)**

```python
def create_retrieve_node(vectorstore, k=4):
    def retrieve_node(state):
        # 1. è·å–æŸ¥è¯¢ï¼ˆä¼˜å…ˆä½¿ç”¨ retrieval_queryï¼‰
        query = state.get("retrieval_query") or state["question"]
        
        # 2. æ‰§è¡Œæ£€ç´¢
        docs = vectorstore.similarity_search(query, k=k)
        
        # 3. è®¡ç®—è´¨é‡åˆ†æ•°
        retrieval_score = calculate_score(docs)
        
        # 4. æ›´æ–° State
        state["retrieved_docs"] = docs
        state["retrieval_score"] = retrieval_score
        state["need_more_context"] = retrieval_score < 0.6
        
        return state
    return retrieve_node
```

**åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨é€‰æ‹©æœ€ä½³æŸ¥è¯¢ï¼ˆæ”¹å†™æŸ¥è¯¢ä¼˜å…ˆï¼‰
- âœ… è®¡ç®—æ£€ç´¢è´¨é‡åˆ†æ•°
- âœ… åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´å¤šä¸Šä¸‹æ–‡
- âœ… å®Œæ•´çš„å¼‚å¸¸å¤„ç†

**2. ç”ŸæˆèŠ‚ç‚¹ (generate_node)**

```python
def create_generate_node(llm, prompt_template=None):
    def generate_node(state):
        # 1. è·å–æ•°æ®
        question = state["question"]
        docs = state.get("retrieved_docs", [])
        
        # 2. ç»„è£…ä¸Šä¸‹æ–‡
        context = "\n\n".join([doc.page_content for doc in docs])
        
        # 3. ç»„è£… Prompt
        prompt = template.format(context=context, question=question)
        
        # 4. ç”Ÿæˆç­”æ¡ˆ
        answer = llm.generate(prompt)
        
        # 5. è®¡ç®—ç½®ä¿¡åº¦
        confidence = calculate_confidence(state, answer)
        
        # 6. æ›´æ–° State
        state["answer"] = answer
        state["confidence_score"] = confidence
        
        return state
    return generate_node
```

**åŠŸèƒ½**ï¼š
- âœ… æ™ºèƒ½å¤„ç†æ— æ–‡æ¡£æƒ…å†µ
- âœ… çµæ´»çš„ä¸Šä¸‹æ–‡ç»„è£…
- âœ… æ”¯æŒè‡ªå®šä¹‰ Prompt æ¨¡æ¿
- âœ… è‡ªåŠ¨è®¡ç®—ç½®ä¿¡åº¦åˆ†æ•°

**3. å†³ç­–èŠ‚ç‚¹ (decide_node)**

```python
def decide_node(state):
    """å†³ç­–èŠ‚ç‚¹ï¼šè¿”å›ä¸‹ä¸€æ­¥æ“ä½œï¼ˆå­—ç¬¦ä¸²ï¼‰"""
    
    # æ£€æŸ¥å„ç§ç»ˆæ­¢æ¡ä»¶
    if state.get("step_count", 0) >= state.get("max_steps", 5):
        return "end"  # è¾¾åˆ°æœ€å¤§æ­¥æ•°
    
    if state.get("answer"):
        return "end"  # å·²æœ‰ç­”æ¡ˆ
    
    if state.get("error"):
        return "end"  # æœ‰é”™è¯¯
    
    # æ£€æŸ¥æ‰§è¡Œæµç¨‹
    if state.get("retrieved_docs") is None:
        return "retrieve"  # è¿˜æœªæ£€ç´¢
    
    if state.get("retrieved_docs") and not state.get("answer"):
        return "generate"  # æ£€ç´¢å®Œæ¯•ï¼Œå¾…ç”Ÿæˆ
    
    return "end"  # é»˜è®¤ç»“æŸ
```

**åŠŸèƒ½**ï¼š
- âœ… æ¸…æ™°çš„å†³ç­–é€»è¾‘
- âœ… é˜²æ­¢æ— é™å¾ªç¯
- âœ… æ”¯æŒæ¡ä»¶åˆ†æ”¯
- âœ… é”™è¯¯è‡ªåŠ¨ç»ˆæ­¢

#### 2.3 æ–‡æ¡£æ€»ç»“

**å·²å®Œæˆæ–‡æ¡£**ï¼š

1. **`docs/AgentèŠ‚ç‚¹å®ç°æŒ‡å¼•.md`** (25,000+ å­—)
   - èŠ‚ç‚¹æ¦‚å¿µè¯¦è§£
   - æ ¸å¿ƒèŠ‚ç‚¹å®ç°åˆ†æ
   - è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ
   - å¸¸è§é—®é¢˜è§£ç­”

**æ–‡æ¡£å†…å®¹**ï¼š
- âœ… ä»€ä¹ˆæ˜¯èŠ‚ç‚¹ï¼ˆæ¦‚å¿µã€ç‰¹ç‚¹ã€å¯ç»„åˆæ€§ï¼‰
- âœ… æ ¸å¿ƒèŠ‚ç‚¹å®ç°ï¼ˆæ£€ç´¢ã€ç”Ÿæˆã€å†³ç­–ï¼‰
- âœ… è¾…åŠ©èŠ‚ç‚¹å®ç°ï¼ˆæ”¹å†™ã€è¯„ä¼°ï¼‰
- âœ… è®¾è®¡æ¨¡å¼ï¼ˆå·¥å‚ã€ç±»æ–¹æ³•ã€è£…é¥°å™¨ï¼‰
- âœ… æœ€ä½³å®è·µï¼ˆé”™è¯¯å¤„ç†ã€æ—¥å¿—ã€æ­¥éª¤è®¡æ•°ï¼‰

#### 2.4 æµ‹è¯•æ–‡ä»¶

**æ–‡ä»¶**: `examples/test_agent_nodes.py` (580+ è¡Œ)

**æµ‹è¯•ç”¨ä¾‹**ï¼š

| æµ‹è¯• | å†…å®¹ | éªŒè¯ç‚¹ |
|------|------|--------|
| æµ‹è¯•1 | æ£€ç´¢èŠ‚ç‚¹ | æ–‡æ¡£æ£€ç´¢ã€è´¨é‡è¯„åˆ†ã€æ­¥éª¤è®¡æ•° |
| æµ‹è¯•2 | ç”ŸæˆèŠ‚ç‚¹ | ç­”æ¡ˆç”Ÿæˆã€ç½®ä¿¡åº¦è®¡ç®— |
| æµ‹è¯•3 | å†³ç­–èŠ‚ç‚¹ | 5ç§å†³ç­–åœºæ™¯ |
| æµ‹è¯•4 | å®Œæ•´å·¥ä½œæµ | retrieve â†’ decide â†’ generate |
| æµ‹è¯•5 | è¾…åŠ©èŠ‚ç‚¹ | æ”¹å†™ã€è¯„ä¼°ã€ç»§ç»­åˆ¤æ–­ |

**ç‰¹ç‚¹**ï¼š
- âœ… ä½¿ç”¨ Mock å¯¹è±¡ï¼Œæ— éœ€çœŸå® LLM/VectorStore
- âœ… æ¸…æ™°çš„æ­¥éª¤æ ‡è®°å’Œè¾“å‡º
- âœ… å®Œæ•´çš„æ–­è¨€éªŒè¯
- âœ… æ•™å­¦å¯¼å‘çš„è®¾è®¡

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡

| æ¨¡å— | æ–‡ä»¶ | è¡Œæ•° |
|------|------|------|
| **State æ¨¡å—** | `src/agent/state.py` | 420+ |
| **Nodes æ¨¡å—** | `src/agent/nodes.py` | 450+ |
| **State æµ‹è¯•** | `examples/test_agent_state.py` | 440+ |
| **State ç»ƒä¹ ** | `examples/practice_custom_state.py` | 500+ |
| **Nodes æµ‹è¯•** | `examples/test_agent_nodes.py` | 580+ |
| **æ€»è®¡** | 5 ä¸ªæ–‡ä»¶ | **2,390+ è¡Œ** |

### æ–‡æ¡£ç»Ÿè®¡

| æ–‡æ¡£ | å­—æ•° |
|------|------|
| `AgentStateæ¨¡å—çŸ¥è¯†ç‚¹æ€»ç»“.md` | 70,000+ |
| `é˜¶æ®µä¸‰_Stateå®ç°æŒ‡å¼•.md` | 30,000+ |
| `é˜¶æ®µä¸‰_å¿«é€Ÿå¼€å§‹.md` | 12,000+ |
| `å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å­—æ®µ_å®è·µæŒ‡å—.md` | 18,000+ |
| `AgentèŠ‚ç‚¹å®ç°æŒ‡å¼•.md` | 25,000+ |
| **æ€»è®¡** | **155,000+ å­—** |

### åŠŸèƒ½ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| **State ç‰ˆæœ¬** | 3 ä¸ª |
| **State å­—æ®µ** | 18 ä¸ªï¼ˆå®Œæ•´ç‰ˆï¼‰ |
| **è¾…åŠ©å‡½æ•°** | 6 ä¸ª |
| **æ ¸å¿ƒèŠ‚ç‚¹** | 3 ä¸ª |
| **è¾…åŠ©èŠ‚ç‚¹** | 4 ä¸ª |
| **æµ‹è¯•ç”¨ä¾‹** | 10 ä¸ª |
| **ç»ƒä¹ ç¤ºä¾‹** | 4 ä¸ª |

---

## ğŸ¯ è®¾è®¡äº®ç‚¹

### 1. æ¸è¿›å¼å­¦ä¹ è®¾è®¡

```
AgentStateBasic â†’ AgentStateConversational â†’ AgentState
    (3å­—æ®µ)            (7å­—æ®µ)                (18å­—æ®µ)
       â†“                  â†“                      â†“
     å…¥é—¨               å®è·µ                  ç”Ÿäº§
```

**ä¼˜åŠ¿**ï¼š
- âœ… é™ä½å­¦ä¹ æ›²çº¿
- âœ… é€æ­¥ç†è§£å¤æ‚æ¦‚å¿µ
- âœ… çµæ´»é€‰æ‹©åˆé€‚ç‰ˆæœ¬

### 2. å·¥å‚æ¨¡å¼æ³¨å…¥ä¾èµ–

```python
# ä¼ ç»Ÿæ–¹å¼ - éš¾ä»¥æµ‹è¯•
def retrieve_node(state):
    vectorstore = get_global_vectorstore()  # å…¨å±€å˜é‡
    docs = vectorstore.search(state["question"])
    return state

# å·¥å‚æ¨¡å¼ - ä¾¿äºæµ‹è¯•å’Œé…ç½®
def create_retrieve_node(vectorstore, k=4):
    def retrieve_node(state):
        docs = vectorstore.search(state["question"], k=k)
        return state
    return retrieve_node

# ä½¿ç”¨
retrieve_node = create_retrieve_node(my_vectorstore, k=4)
test_retrieve_node = create_retrieve_node(mock_vectorstore)  # æµ‹è¯•
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¾èµ–æ³¨å…¥ï¼Œä¾¿äºæµ‹è¯•
- âœ… å‚æ•°åŒ–é…ç½®
- âœ… ä»£ç è§£è€¦

### 3. å®Œå–„çš„é”™è¯¯å¤„ç†

```python
def retrieve_node(state):
    try:
        # ä¸šåŠ¡é€»è¾‘
        docs = vectorstore.search(state["question"])
        state["retrieved_docs"] = docs
    except Exception as e:
        # ä¸ä¸­æ–­æµç¨‹ï¼Œè®°å½•é”™è¯¯
        state["error"] = f"æ£€ç´¢å¤±è´¥: {str(e)}"
        state["retrieved_docs"] = []  # æä¾›é»˜è®¤å€¼
    
    return state  # ç¡®ä¿æ€»æ˜¯è¿”å› State
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸ä¼šå› å¼‚å¸¸ä¸­æ–­ Agent
- âœ… é”™è¯¯ä¿¡æ¯å¯è¿½è¸ª
- âœ… æä¾›åˆç†çš„é»˜è®¤å€¼

### 4. ç±»å‹å®‰å…¨

```python
from typing import TypedDict, Optional, List
from langchain.schema import Document

class AgentState(TypedDict):
    question: str                          # æ˜ç¡®ç±»å‹
    retrieved_docs: Optional[List[Document]]  # å¯é€‰ + æ³›å‹
    retrieval_score: Optional[float]       # å¯é€‰

def retrieve_node(state: AgentState) -> AgentState:
    # IDE æä¾›è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥
    return state
```

**ä¼˜åŠ¿**ï¼š
- âœ… IDE è‡ªåŠ¨è¡¥å…¨
- âœ… ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- âœ… æ›´å¥½çš„ä»£ç å¯è¯»æ€§

---

## ğŸ’¡ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### çŸ¥è¯†ç‚¹1ï¼šState æ˜¯ Agent çš„"è®°å¿†"

```
State = Agent æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å…±äº«å·¥ä½œç©ºé—´

åˆå§‹ State
    â†“
[èŠ‚ç‚¹1] â†’ State (æ·»åŠ äº†æ•°æ®A)
    â†“
[èŠ‚ç‚¹2] â†’ State (æ·»åŠ äº†æ•°æ®B)
    â†“
[èŠ‚ç‚¹3] â†’ State (æ·»åŠ äº†æ•°æ®C)
    â†“
æœ€ç»ˆ State (åŒ…å«æ‰€æœ‰æ•°æ®)
```

**å…³é”®**ï¼š
- State åœ¨èŠ‚ç‚¹é—´ä¼ é€’
- æ¯ä¸ªèŠ‚ç‚¹è¯»å–å’Œæ›´æ–° State
- State è®°å½•å®Œæ•´çš„æ‰§è¡Œå†å²

### çŸ¥è¯†ç‚¹2ï¼šèŠ‚ç‚¹æ˜¯çº¯å‡½æ•°

```python
# èŠ‚ç‚¹çš„æœ¬è´¨
è¾“å…¥: AgentState
å¤„ç†: æ‰§è¡Œä¸šåŠ¡é€»è¾‘
è¾“å‡º: æ›´æ–°åçš„ AgentState

# èŠ‚ç‚¹ç‰¹ç‚¹
1. èŒè´£å•ä¸€ï¼ˆåªåšä¸€ä»¶äº‹ï¼‰
2. æ— å‰¯ä½œç”¨ï¼ˆåªé€šè¿‡ State äº¤äº’ï¼‰
3. å¯ç»„åˆï¼ˆåƒç§¯æœ¨ä¸€æ ·ç»„åˆï¼‰
```

### çŸ¥è¯†ç‚¹3ï¼šå†³ç­–èŠ‚ç‚¹è¿”å›å­—ç¬¦ä¸²

```python
# æ™®é€šèŠ‚ç‚¹ - è¿”å› State
def retrieve_node(state: AgentState) -> AgentState:
    state["retrieved_docs"] = docs
    return state

# å†³ç­–èŠ‚ç‚¹ - è¿”å›å­—ç¬¦ä¸²ï¼ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹åï¼‰
def decide_node(state: AgentState) -> str:
    if state.get("answer"):
        return "end"
    else:
        return "generate"
```

**ç”¨é€”**ï¼šåœ¨ Graph ä¸­å®ç°æ¡ä»¶åˆ†æ”¯

### çŸ¥è¯†ç‚¹4ï¼šå·¥å‚æ¨¡å¼æ³¨å…¥ä¾èµ–

```python
# ä¸ºä»€ä¹ˆéœ€è¦å·¥å‚æ¨¡å¼ï¼Ÿ
# - èŠ‚ç‚¹éœ€è¦å¤–éƒ¨èµ„æºï¼ˆLLM, VectorStoreï¼‰
# - ç›´æ¥åœ¨èŠ‚ç‚¹ä¸­åˆ›å»ºä¼šé™ä½çµæ´»æ€§

def create_retrieve_node(vectorstore):  # å·¥å‚å‡½æ•°
    def retrieve_node(state):           # å®é™…èŠ‚ç‚¹
        docs = vectorstore.search(...)   # ä½¿ç”¨æ³¨å…¥çš„ä¾èµ–
        return state
    return retrieve_node
```

---

## ğŸ“ å­¦ä¹ æˆæœ

é€šè¿‡å®Œæˆè¿™ä¸¤ä¸ªæ¨¡å—ï¼Œä½ å·²ç»æŒæ¡ï¼š

### æŠ€æœ¯èƒ½åŠ›

âœ… **State è®¾è®¡**
- TypedDict çš„ä½¿ç”¨
- çŠ¶æ€ç®¡ç†è®¾è®¡
- å¯é€‰å­—æ®µå¤„ç†
- æ¸è¿›å¼è®¾è®¡ç†å¿µ

âœ… **èŠ‚ç‚¹å®ç°**
- çº¯å‡½æ•°è®¾è®¡
- å·¥å‚æ¨¡å¼åº”ç”¨
- é”™è¯¯å¤„ç†æœºåˆ¶
- ä¾èµ–æ³¨å…¥

âœ… **Python é«˜çº§ç‰¹æ€§**
- ç±»å‹æ³¨è§£ï¼ˆTypedDict, Optional, Listï¼‰
- é—­åŒ…ï¼ˆå·¥å‚å‡½æ•°ï¼‰
- è£…é¥°å™¨ï¼ˆå¯é€‰ï¼‰
- å¼‚å¸¸å¤„ç†

### æ¦‚å¿µç†è§£

âœ… **LangGraph æ ¸å¿ƒæ¦‚å¿µ**
- Stateï¼šAgent çš„å…±äº«å·¥ä½œç©ºé—´
- Nodeï¼šå¤„ç†æ­¥éª¤ï¼ˆçº¯å‡½æ•°ï¼‰
- Edgeï¼šèŠ‚ç‚¹é—´çš„è¿æ¥ï¼ˆä¸‹ä¸€æ­¥è¦å­¦ï¼‰

âœ… **Agent è®¾è®¡æ¨¡å¼**
- æ•°æ®æµç®¡ç†ï¼ˆStateï¼‰
- é€»è¾‘åˆ†è§£ï¼ˆNodeï¼‰
- æ§åˆ¶æµç¨‹ï¼ˆDecideï¼‰

âœ… **è½¯ä»¶å·¥ç¨‹å®è·µ**
- èŒè´£å•ä¸€åŸåˆ™
- ä¾èµ–æ³¨å…¥
- é”™è¯¯å¤„ç†ç­–ç•¥
- æµ‹è¯•é©±åŠ¨å¼€å‘

---

## ğŸ“‹ å¾…å®Œæˆä»»åŠ¡

### ä¸‹ä¸€æ­¥ï¼šå›¾æ„å»ºï¼ˆGraphï¼‰

**æ–‡ä»¶**: `src/agent/graph.py`

**éœ€è¦å®ç°**ï¼š
1. ä½¿ç”¨ `StateGraph` åˆ›å»º Agent
2. æ·»åŠ èŠ‚ç‚¹åˆ° Graph
3. å®šä¹‰èŠ‚ç‚¹é—´çš„è¾¹ï¼ˆEdgeï¼‰
4. å®ç°æ¡ä»¶åˆ†æ”¯ï¼ˆConditional Edgeï¼‰
5. è®¾ç½®èµ·ç‚¹å’Œç»ˆç‚¹

**ç¤ºä¾‹ä»£ç **ï¼š
```python
from langgraph.graph import StateGraph, END

# åˆ›å»ºå›¾
graph = StateGraph(AgentState)

# æ·»åŠ èŠ‚ç‚¹
graph.add_node("retrieve", retrieve_node)
graph.add_node("generate", generate_node)

# æ·»åŠ è¾¹
graph.add_edge("retrieve", "generate")

# æ·»åŠ æ¡ä»¶è¾¹
graph.add_conditional_edges(
    "decide",
    decide_node,
    {
        "retrieve": "retrieve",
        "generate": "generate",
        "end": END
    }
)

# è®¾ç½®èµ·ç‚¹å’Œç»ˆç‚¹
graph.set_entry_point("decide")
graph.set_finish_point("generate")

# ç¼–è¯‘å›¾
agent = graph.compile()
```

**é¢„æœŸå·¥ä½œé‡**ï¼š
- ğŸ“ ä»£ç ï¼š300+ è¡Œ
- ğŸ“„ æ–‡æ¡£ï¼š20,000+ å­—
- ğŸ§ª æµ‹è¯•ï¼š300+ è¡Œ
- â±ï¸ æ—¶é—´ï¼š1-2 å¤©

---

## ğŸ‰ æˆå°±è§£é”

- ğŸ† **State è®¾è®¡å¤§å¸ˆ**ï¼šå®ç°äº† 3 ä¸ªç‰ˆæœ¬çš„ AgentState
- ğŸ“š **æ–‡æ¡£è¾¾äºº**ï¼šç¼–å†™äº† 155,000+ å­—çš„è¯¦ç»†æ–‡æ¡£
- ğŸ§ª **æµ‹è¯•ä¸“å®¶**ï¼šå®ç°äº† 10 ä¸ªæµ‹è¯•ç”¨ä¾‹ + 4 ä¸ªç»ƒä¹ 
- ğŸ¯ **ç±»å‹å®‰å…¨å€¡å¯¼è€…**ï¼šå…¨é¢ä½¿ç”¨ TypedDict
- ğŸ’¡ **æ•™å­¦èƒ½æ‰‹**ï¼šè®¾è®¡äº†æ¸è¿›å¼å­¦ä¹ è·¯å¾„
- ğŸ› ï¸ **èŠ‚ç‚¹å·¥ç¨‹å¸ˆ**ï¼šå®ç°äº† 7 ä¸ªåŠŸèƒ½èŠ‚ç‚¹
- ğŸ—ï¸ **æ¶æ„è®¾è®¡å¸ˆ**ï¼šä½¿ç”¨å·¥å‚æ¨¡å¼å’Œä¾èµ–æ³¨å…¥

---

## ğŸ“– ç›¸å…³æ–‡ä»¶ç´¢å¼•

### æºä»£ç 
- `src/agent/state.py` - State å®šä¹‰ï¼ˆ420+ è¡Œï¼‰âœ…
- `src/agent/nodes.py` - èŠ‚ç‚¹å®ç°ï¼ˆ450+ è¡Œï¼‰âœ…
- `src/agent/graph.py` - å›¾æ„å»ºï¼ˆå¾…å®ç°ï¼‰â³

### æµ‹è¯•
- `examples/test_agent_state.py` - State æµ‹è¯•ï¼ˆ440+ è¡Œï¼‰âœ…
- `examples/test_agent_nodes.py` - Nodes æµ‹è¯•ï¼ˆ580+ è¡Œï¼‰âœ…
- `examples/practice_custom_state.py` - State ç»ƒä¹ ï¼ˆ500+ è¡Œï¼‰âœ…
- `examples/test_agent_graph.py` - Graph æµ‹è¯•ï¼ˆå¾…åˆ›å»ºï¼‰â³

### æ–‡æ¡£
- `docs/AgentStateæ¨¡å—çŸ¥è¯†ç‚¹æ€»ç»“.md` - State çŸ¥è¯†ç‚¹ï¼ˆ70K å­—ï¼‰âœ…
- `docs/é˜¶æ®µä¸‰_Stateå®ç°æŒ‡å¼•.md` - State å®ç°æŒ‡å¼•ï¼ˆ30K å­—ï¼‰âœ…
- `docs/é˜¶æ®µä¸‰_å¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå¼€å§‹ï¼ˆ12K å­—ï¼‰âœ…
- `docs/å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å­—æ®µ_å®è·µæŒ‡å—.md` - å®è·µæŒ‡å—ï¼ˆ18K å­—ï¼‰âœ…
- `docs/AgentèŠ‚ç‚¹å®ç°æŒ‡å¼•.md` - èŠ‚ç‚¹å®ç°æŒ‡å¼•ï¼ˆ25K å­—ï¼‰âœ…
- `docs/Agentå›¾æ„å»ºæŒ‡å¼•.md` - å›¾æ„å»ºæŒ‡å¼•ï¼ˆå¾…åˆ›å»ºï¼‰â³

---

## ğŸ’¬ å¦‚ä½•è¿è¡Œæµ‹è¯•

### è¿è¡Œ State æµ‹è¯•

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate pytorch2.6.0

# è¿è¡Œå®Œæ•´æµ‹è¯•
python examples/test_agent_state.py

# è¿è¡Œè‡ªå®šä¹‰å­—æ®µç»ƒä¹ 
python examples/practice_custom_state.py
```

### è¿è¡Œ Nodes æµ‹è¯•

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate pytorch2.6.0

# è¿è¡ŒèŠ‚ç‚¹æµ‹è¯•
python examples/test_agent_nodes.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
======================================================================
ğŸš€ Agent èŠ‚ç‚¹æµ‹è¯•
======================================================================

æµ‹è¯• 1: æ£€ç´¢èŠ‚ç‚¹ (retrieve_node)
âœ… æ£€ç´¢åˆ° 3 ä¸ªæ–‡æ¡£
âœ… æ£€ç´¢è´¨é‡åˆ†æ•°: 0.88

æµ‹è¯• 2: ç”ŸæˆèŠ‚ç‚¹ (generate_node)
âœ… ç”Ÿæˆçš„ç­”æ¡ˆ: Python æ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€...
âœ… ç½®ä¿¡åº¦åˆ†æ•°: 0.85

æµ‹è¯• 3: å†³ç­–èŠ‚ç‚¹ (decide_node)
âœ… æ‰€æœ‰å†³ç­–åœºæ™¯é€šè¿‡

æµ‹è¯• 4: å®Œæ•´å·¥ä½œæµ
âœ… retrieve â†’ generate æµç¨‹æ­£å¸¸

æµ‹è¯• 5: è¾…åŠ©èŠ‚ç‚¹
âœ… æ‰€æœ‰è¾…åŠ©èŠ‚ç‚¹æ­£å¸¸

======================================================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
======================================================================
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **å¤ä¹ ä»Šå¤©çš„å†…å®¹**ï¼ˆå»ºè®®ï¼‰
   - é˜…è¯» `AgentStateæ¨¡å—çŸ¥è¯†ç‚¹æ€»ç»“.md`
   - é˜…è¯» `AgentèŠ‚ç‚¹å®ç°æŒ‡å¼•.md`
   - è¿è¡Œæµ‹è¯•ï¼Œç†è§£æ‰§è¡Œæµç¨‹

2. **å‡†å¤‡å­¦ä¹ å›¾æ„å»º**ï¼ˆæ˜å¤©ï¼‰
   - ç†è§£ StateGraph çš„æ¦‚å¿µ
   - äº†è§£å¦‚ä½•è¿æ¥èŠ‚ç‚¹
   - å­¦ä¹ æ¡ä»¶åˆ†æ”¯çš„å®ç°

3. **å®è·µç»ƒä¹ **ï¼ˆå¯é€‰ï¼‰
   - ä¿®æ”¹èŠ‚ç‚¹é€»è¾‘ï¼Œè§‚å¯Ÿå˜åŒ–
   - æ·»åŠ è‡ªå®šä¹‰èŠ‚ç‚¹
   - å°è¯•ä¸åŒçš„å†³ç­–é€»è¾‘

---

**æ­å–œä½ å®Œæˆäº†é˜¶æ®µä¸‰çš„æ ¸å¿ƒæ¨¡å—ï¼** ğŸŠ

**å·²å®Œæˆ**ï¼š
- âœ… AgentState è®¾è®¡å’Œå®ç°
- âœ… æ ¸å¿ƒèŠ‚ç‚¹å®ç°
- âœ… è¾…åŠ©èŠ‚ç‚¹å®ç°
- âœ… è¯¦ç»†æ–‡æ¡£å’Œæµ‹è¯•

**ä¸‹ä¸€ä¸ªç›®æ ‡**ï¼šæ„å»º Agent å›¾ï¼ˆGraphï¼‰ï¼Œè®©æ‰€æœ‰èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œå½¢æˆå®Œæ•´çš„ Agentï¼

---

**åˆ›å»ºæ—¥æœŸ**: 2026-01-13  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆ
